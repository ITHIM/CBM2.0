max(td)
min(td)
td <- data.frame(td)
td$age_group <- tdhealth_mmets$age_group
td$Sex_B01ID <- tdhealth_mmets$Sex_B01ID
pif <- PAF(pop = td, non_travel_mmet = people_with_no_trips)
fix(PAF)
pif <- PAF(pop = td, non_travel_mmet = people_with_no_trips, "baseline_mmet")
fix(PAF)
pif <- PAF(pop = td, non_travel_mmet = people_with_no_trips, "baseline_mmet")
fix(PAF)
pif <- PAF(pop = td, non_travel_mmet = people_with_no_trips, "baseline_mmet")
fix(PAF)
fix(PAF)
pif <- PAF(pop = td, non_travel_mmet = people_with_no_trips, "baseline_mmet")
fix(PAF)
class(pif)
fix(PAF)
dim(pif)
fix(PAF)
pif <- PAF(pop = td, non_travel_mmet = people_with_no_trips, "baseline_mmet")
write.csv(pif, "pif.csv", row.names = F)
View(pif)
fix(PAF)
pop <- td
people_with_no_trips_rr <- people_with_no_trips
people_with_no_trips_rr <- mmet2RR(people_with_no_trips_rr, mmet2RR, cn)
View(people_with_no_trips_rr)
people_with_no_trips_rr <- mmet2RR(people_with_no_trips_rr, mmet2RR, "health_mmets")
people_with_no_trips_rr <- mmet2RR(people_with_no_trips_rr, mmet2RR_mat, "health_mmets")
View(people_with_no_trips_rr)
fix(mmet2RR)
View(mmet2RR_mat)
people_with_no_trips_rr <- mmet2RR(people_with_no_trips_rr, mmet2RR_mat, "health_mmets")
View(people_with_no_trips_rr)
pif <- PAF(pop = td, non_travel_mmet = people_with_no_trips_rr, "baseline_mmet")
View(pif)
pop <- td
non_travel_mmet <- people_with_no_trips_rr
reduced_pop <- subset(pop, Sex_B01ID == 1 & age_group == "60 - 64")
nm_reduced_pop <- subset(non_travel_mmet, Sex_B01ID == 1 & age_group == "60 - 64")
total_pop <- nrow (reduced_pop) + nrow (nm_reduced_pop)
active_percent <- nrow (reduced_pop) / total_pop * 100
non_active_percent <- 100 - active_percent
active_percent
non_active_percent
sumPRR <- (active_percent * sum (reduced_pop$baseline_mmet) / nrow(reduced_pop)) +
(sum(nm_reduced_pop$health_mmets) * non_active_percent) / nrow(nm_reduced_pop)
sumPRR
View(reduced_pop)
sumPRR <- (active_percent * sum (reduced_pop$baseline_mmet) / nrow(reduced_pop))
sumPRR
fix(PAF)
pif <- PAF(pop = td, non_travel_mmet = people_with_no_trips_rr, "baseline_mmet")
View(pif)
fix(PAF)
pif <- PAF(pop = td, non_travel_mmet = people_with_no_trips_rr, "baseline_mmet")
View(pif)
library(plyr)
class(pif)
pif <- arrange(pif, pif[,1])
pif <- as.data.frame(pif)
pif <- arrange(pif, pif$`age band`)
View(pif)
gbd <- read.csv("health calculations/gbd.csv", header = T)
View(gbd)
yll <- combine_health_and_pif(pif = pif, hc = gbd, hm = "yll")
fix(combine_health_and_pif)
fix(PAF)
fix(combine_health_and_pif)
fix(combine_health_and_pif)
yll <- combine_health_and_pif(pif = pif, hc = gbd, hm = "yll")
gbd <- read.csv("health calculations/gbd.csv", header = T, as.is = T)
yll <- combine_health_and_pif(pif = pif, hc = gbd, hm = "yll")
View(yll)
hc <- gbd
hm <- "yll"
m <- pif
sub <- subset(as.data.frame(hc), gender == m[j, 2] & age == m[j, 1])
sub <- subset(as.data.frame(hc), gender == m[1, 2] & age == m[1, 1])
View(sub)
as.numeric(m[1, cn[1]]) * as.numeric.factor(sub[[hm]])
as.numeric(m[1, cn[1]])
as.numeric(m[1, cn[3]])
View(m)
cn[3]
as.numeric(m[1, cn[23]])
(m[1, cn[23]])
(m[1, cn[23]])
as.numeric(m[1, cn[23]])
class(pif)
class(pif$MS1_ebik0_eq0)
as.numeric(as.character(m[1, cn[23]]))
as.numeric.factor(sub[["yll"]])
View(sub)
class(sub$yll)
as.numeric.factor(sub$yll)
as.numeric(as.character(sub$yll)
)
as.numeric(as.character(sub$yll))
as.numeric(as.character(sub[["yll"]]))
fix(combine_health_and_pif)
yll <- combine_health_and_pif(pif = pif, hc = gbd, hm = "yll")
View(yll)
yll <- combine_health_and_pif(pif = pif, hc = gbd, hm = "yll")
fix(combine_health_and_pif)
yll <- combine_health_and_pif(pif = pif, hc = gbd, hm = "yll")
fix(combine_health_and_pif)
yll <- combine_health_and_pif(pif = pif, hc = gbd, hm = "yll")
fix(combine_health_and_pif)
fix(combine_health_and_pif)
hc = gbd
hm = "yll"
fix(combine_health_and_pif)
m <- pif
cn <- append("baseline_mmet", grep('MS',names(pop), value = TRUE))
head(cn)
yll <- combine_health_and_pif(pif = pif, hc = gbd, hm = "yll")
View(yll)
fix(combine_health_and_pif)
fix(combine_health_and_pif)
fix(combine_health_and_pif)
cat(as.numeric(as.character(m[1, cn[1]])), " : ", as.numeric.factor(sub[["yll"]]) , "\n")
cat(as.numeric(as.character(m[1, cn[5]])), " : ", as.numeric.factor(sub[["yll"]]) , "\n")
fix(combine_health_and_pif)
yll <- combine_health_and_pif(pif = pif, hc = gbd, hm = "yll")
View(yll)
fix(combine_health_and_pif)
m[1, cn[2]]
class(m)
as.matrix(m)[1, cn[2]]
fix(combine_health_and_pif)
yll <- combine_health_and_pif(pif = pif, hc = gbd, hm = "yll")
View(yll)
fix(combine_health_and_pif)
yll <- combine_health_and_pif(pif = pif, hc = gbd, hm = "yll")
View(yll)
fix(combine_health_and_pif)
yll <- combine_health_and_pif(pif = pif, hc = gbd, hm = "yll")
View(gbd)
sort(unique(gbd$age))
sort(unique(m$`age band`))
sort(unique(pif$`age band`))
class(pif)
class(pif$baseline_mmet)
class(pif$MS1_ebik0_eq0)
write.csv(pif, "rr.csv", row.names = F)
rr <- read.csv("rr.csv", header = T, as.is = T)
View(rr)
class(rr$age.band)
class(rr$baseline_mmet)
class(rr$MS64_ebik1_eq1)
yll <- combine_health_and_pif(pif = rr, hc = gbd, hm = "yll")
View(yll)
fix(combine_health_and_pif)
fix(combine_health_and_pif)
yll <- combine_health_and_pif(pif = rr, hc = gbd, hm = "yll")
nrow(subset(as.data.frame(hc), gender == 1 & age == "30 - 39"))
subset(as.data.frame(hc), gender == 1 & age == "30 - 39")
sub <- subset(as.data.frame(hc), gender == 1 & age == "30 - 39")
m <- as.matrix(pif)
cat(as.numeric(as.character(m[4, cn[1]])), " : ",as.numeric(as.character(sub[[hm]])) , "\n")
as.numeric(as.character(sub[[hm]]))
as.numeric(as.character(sub$yll))
View(sub)
class(sub$yll)
as.numeric(sub$yll)
gbd <- read.csv("health calculations/gbd.csv", header = T, as.is = T)
View(gbd)
yll <- combine_health_and_pif(pif = rr, hc = gbd, hm = "yll")
View(yll)
fix(PAF)
unique(as.character(td$age_group))
View(mmet2RR_mat)
history(max.show=Inf)
window(history(max.show=Inf))
View(MS1_ebik0_eq0)
View(bl)
sort(unique(bl$age_group))
View(mmet2RR_mat)
yll <- combine_health_and_pif(pif = rr, hc = gbd, hm = "yll")
View(yll)
fix(combine_health_and_pif)
yll <- combine_health_and_pif(pif = rr, hc = gbd, hm = "yll")
sort(unique(rr$age_group))
sort(unique(rr$age.band))
sort(unique(pif$`age band`))
View(baseline)
fix(combine_health_and_pif)
source("init.R")
mmets <- inner_join(health_mmets, subset(baseline, select = c("ID", "age_group", "Sex_B01ID")), by = "ID")
library(plyr)
mmets <- inner_join(health_mmets, subset(baseline, select = c("ID", "age_group", "Sex_B01ID")), by = "ID")
??inner_join
library(dplyr)
??inner_join
mmets <- inner_join(health_mmets, subset(baseline, select = c("ID", "age_group", "Sex_B01ID")), by = "ID")
source("6_CBM2_ScenarioAggregates.R")
mmets <- health_mmets
names(mmets)[names(mmets)=="f.hmmets$health_mmets"] <- "baseline_mmet"
mmets <- inner_join(health_mmets, subset(baseline, select = c("ID", "age_group", "Sex_B01ID")), by = "ID")
create_baseline <- function(bl){}
fix(create_baseline)
fix(create_baseline)
baseline <- create_baseline(bl)
cn <- append("baseline_mmet", grep('MS',names(pop), value = TRUE))
cn <- append("baseline_mmet", grep('MS',names(bl), value = TRUE))
cn
cn <- append("baseline_mmet", grep('MS',names(health_mmets), value = TRUE))
cn
View(mmets)
rr <- mmet2RR(mmets, mmet2RR_mat, cn)
View(rr)
mmets <- inner_join(health_mmets, subset(baseline, select = c("ID", "age_group", "Sex_B01ID")), by = "ID")
library(dplyr)
mmets <- inner_join(health_mmets, subset(baseline, select = c("ID", "age_group", "Sex_B01ID")), by = "ID")
rr <- mmet2RR(mmets, mmet2RR_mat, cn)
View(rr)
rr <- inner_join(rr, subset(baseline, select = c("ID", "age_group", "Sex_B01ID")), by = "ID")
View(rr)
unique(rr$age_group)
sort(unique(rr$age_group))
View(rr)
View(people_with_no_trips)
people_with_no_trips <- mmet2RR(people_with_no_trips, mmet2RR_mat, "health_mmets")
people_with_no_trips_rr <- people_with_no_trips
View(people_with_no_trips_rr)
pif <- PAF(pop = rr, non_travel_mmet = people_with_no_trips_rr)
View(pif)
pif <- data.frame(pif)
pif <- arrange(pif, age.band, gender)
gbd <- read.csv("health calculations/gbd_18_84.csv", header = T, as.is = T)
View(gbd)
class(gbd)
gbd <- arrange(gbd, age, gender)
View(gbd)
yll <- combine_health_and_pif(pif, gbd, "yll")
fix(combine_health_and_pif)
yll <- combine_health_and_pif(pif, gbd, "yll")
View(yll)
fix(combine_health_and_pif)
fix(combine_health_and_pif)
source("health calculations/functions.R")
pif_red <- calculate_pif_reduction(rr, people_with_no_trips_rr)
library(dplyr)
library(dplyr)
pif_red <- calculate_pif_reduction(rr, people_with_no_trips_rr)
View(pif_red)
fix(combine_health_and_pif)
fix(calculate_health_reductions)
fix(calculate_health_reductions)
yll_red <- calculate_health_reductions(pif, gbd, pif_red, "yll")
pif_red$age.band
fix(calculate_health_reductions)
as.numeric(as.character(pif_red$age.band))
as.character(pif_red$age.band)
class(pif_red$age.band)
class(pif_red) <- "character"
class(pif_red$age.band)
pif_red <- calculate_pif_reduction(rr, people_with_no_trips_rr)
class(pif_red$age.band) <- "character"
pif$age.band
as.character(pif$age.band)
fix(calculate_health_reductions)
fix(calculate_health_reductions)
fix(calculate_health_reductions)
yll1 <- calculate_health_reductions(pif, gbd, pif_red, "yll")
View(yll1)
fix(calculate_health_reductions)
fix(calculate_health_reductions)
yll1 <- calculate_health_reductions(pif, gbd, pif_red, "yll")
fix(calculate_health_reductions)
View(pif_red)
fix(calculate_health_reductions)
yll1 <- calculate_health_reductions(pif, gbd, pif_red, "yll")
View(yll1)
fix(calculate_health_reductions)
fix(calculate_health_reductions)
yll1 <- calculate_health_reductions(pif, gbd, pif_red, "yll")
fix(calculate_health_reductions)
yll1 <- calculate_health_reductions(pif, gbd, pif_red, "yll")
spr <- subset(pif_red, gender == 1 & as.character(age.band) == "18 - 29")
nrow(subset(pif_red, gender == 1 & as.character(age.band) == "18 - 29"))
nrow(subset(pif_red, gender == 1 & as.character(age.band) == "18 - 29"))
fix(calculate_pif_reduction)
pif_red <- calculate_pif_reduction(rr, people_with_no_trips_rr)
View(pif_red)
pif_red <- data.frame(pif_red)
View(pif_red)
pif_red <- arrange(pif_red, age.band, gender)
View(pif_red)
class(pif_red$age.band)
class(pif_red$gender)
class(pif_red$baseline_mmet)
?as.data.frame
pif_red <- arrange(pif_red, age.band, gender)
pif_red1 <- as.data.frame(pif_red, stringsAsFactors = F)
View(pif_red1)
pif_red1$age.band
nrow(subset(pif_red, pif_red[,2] == 1 & pif_red[,1] == "18 - 29"))
fix(calculate_health_reductions)
fix(calculate_health_reductions)
spr <- subset(pif_red, pif_red[,2] == 1 & pif_red[,1] == "18 - 29")
class(spr)
spr[1,3]
spr$baseline_mmet
class(spr$baseline_mmet)
as.numeric(spr$baseline_mmet)
as.numeric(as.character(spr$baseline_mmet))
fix(calculate_health_reductions)
rm(yll1)
fix(calculate_health_reductions)
yll_red <- calculate_health_reductions(pif, gbd, pif_red, "yll")
fix(calculate_health_reductions)
yll_red <- calculate_health_reductions(pif, gbd, pif_red, "yll")
View(yll_red)
fix(calculate_health_reductions)
View(yll)
View(pif)
fix(calculate_health_reductions)
fix(calculate_health_reductions)
yll_red <- calculate_health_reductions(pif, gbd, pif_red, "yll")
View(yll_red)
write.csv(yll, "health calculations/yll.csv", row.names = F)
write.csv(yll_red, "health calculations/yll_red.csv", row.names = F)
fix(calculate_health_reductions())
fix(calculate_health_reductions())
fix(calculate_health_reductions)
bl <- read.csv('bl2012_18_84ag_sw.csv', header=T, as.is = T)
lookup <- data.frame(MainMode_B04ID=c(1,2,3,4,5,6,7,8,9,10,11,12,13),modefinal=c(1,2,3,4,3,7,5,5,5,6,6,7,7))
bl$MainMode_Reduced <- lookup$modefinal[match(bl$MainMode_B04ID, lookup$modefinal)]
write.csv(bl, 'bl2012_18_84ag_sw.csv', row.names = F )
fix(create_trips)
listOfScenarios
fix(create_trips)
fix(create_trips)
View(MS2_ebik1_eq1)
dim(bl)
dim(MS1_ebik0_eq0)
fix(create_trips)
fix(create_trips)
fix(create_trips)
fix(create_trips)
fix(create_trips)
fix(create_trips)
fix(create_trips)
fix(create_trips)
fix(create_trips)
fix(create_trips)
tripsdf <- create_trips(bl, listOfScenarios)
View(tripsdf)
fix(create_trips)
sort(unique(bl$MainMode_Reduced))
View(calculate_health_reductions)
View(calculate_health_reductions)
View(calculate_health_reductions)
View(calculate_health_reductions)
View(bl)
fix(lookup)
tdbl <- bl
tdbl$MainMode_Reduced <- lookup$modefinal[match(bl$MainMode_B04ID, lookup$modefinal)]
bl <- read.csv('bl2012_18_84ag_sw.csv', header=T, as.is = T)
bl$MainMode_Reduced <- lookup$modefinal[match(bl$MainMode_B04ID, lookup$MainMode_B04ID)]
View(bl)
write.csv(bl, "bl2012_18_84ag_sw.csv", row.names = F)
rm(tdbl)
tripsdf <- create_trips(bl, listOfScenarios)
View(tripsdf)
fix(combine_health_and_pif)
fix(create_trips)
tripsdf <- create_trips(bl, listOfScenarios)
View(tripsdf)
fix(create_trips)
sort(unique(tripsdf$MS1_ebik0_eq0))
fix(create.post()
)
fix(create_trips)
sort(unique(MS1_ebik0_eq0$ebike))
sort(unique(MS1_ebik1_eq0$ebike))
savehistory("//me-filer1/home$/aa797/Desktop/r-hist.txt")
rm (list = ls())
source("0_topflow2-2012.R")
View(MS1_ebik0_eq0)
unique(MS1_ebik0_eq0$ebike)
hist(MS1_ebik0_eq0$ebike)
tp <- subset(MS1_ebik0_eq0, ebike == 1)
View(tp)
View(baseline)
listOfScenarios
source("0_topflow2-2012.R")
unique(MS1_ebik0_eq0$ebike)
unique(MS1_ebik1_eq0$ebike)
View(baseline)
source("0_topflow2-2012.R")
View(df)
View(bl)
View(hsematch)
source("3_CBM2_Aggregates-2012.R"
)
source("6_CBM2_ScenarioAggregates.R")
source("6_CBM2_ScenarioAggregates.R")
source("6_CBM2_ScenarioAggregates.R")
View(PA_mmets)
source("health calculations/health_calculations.R")
source("health calculations/health_calculations.R")
View(health_mmets)
View(mmets)
View(pif)
View(rr)
View(yll)
View(mmets)
View(mmets)
hist(mmets$MS1_ebik0_eq0 - mmets$MS32_ebik0_eq0)
summary(mmets$MS1_ebik0_eq0 - mmets$MS32_ebik0_eq0)
source("0_topflow2-2012.R")
View(MS1_ebik0_eq0)
View(MS1_ebik1_eq1)
View(MS1_ebik0_eq0)
hist(MS1_ebik0_eq0$METh - MS1_ebik1_eq1$METh)
summary(MS1_ebik0_eq0$METh - MS1_ebik1_eq1$METh)
source("0_topflow2-2012.R")
summary(mmets$MS1_ebik0_eq0 - mmets$MS32_ebik0_eq0)
summary(MS1_ebik0_eq0$METh - MS32_ebik0_eq0$METh)
hist(MS1_ebik0_eq0$METh - MS32_ebik0_eq0$METh)
hist(MS1_ebik0_eq0$METh - MS32_ebik1_eq0$METh)
source("6_CBM2_ScenarioAggregates.R)
")"
)
")
source("6_CBM2_ScenarioAggregates.R")
source("health calculations/health_calculations.R")
summary(mmets$MS1_ebik0_eq0 - mmets$MS32_ebik0_eq0)
View(mmets)
View(MS1_ebik0_eq0)
View(MS32_ebik0_eq0)
hist(MS1_ebik0_eq0$METh - MS32_ebik0_eq0$METh)
View(mmets)
hist(mmets$baseline_mmet - mmets$MS64_ebik0_eq0)
hist(mmets$baseline_mmet - mmets$MS32_ebik0_eq0)
summary(mmets$baseline_mmet - mmets$MS32_ebik0_eq0)
summary(mmets$baseline_mmet - mmets$MS64_ebik0_eq0)
summary(mmets$MS32_ebik0_eq0 - mmets$MS64_ebik0_eq0)
hist(mmets$MS32_ebik0_eq0 - mmets$MS64_ebik0_eq0)
View(MS1_ebik0_eq0)
View(MS64_ebik0_eq0)
hist(MS1_ebik0_eq0$METh - MS64_ebik0_eq0$METh)
sum(MS1_ebik0_eq0$METh - MS64_ebik0_eq0$METh)
View(rr)
source("3_CBM2_Aggregates-2012.R")
(ebikes == 0 && (nrow(baseline[baseline$Cycled != 1 & baseline$cyclist == 1 & (baseline$Pcyc > baseline$justrandom) ,]) > 0))
ebikes = 0
(ebikes == 0 && (nrow(baseline[baseline$Cycled != 1 & baseline$cyclist == 1 & (baseline$Pcyc > baseline$justrandom) ,]) > 0))
nrow(baseline[baseline$Cycled != 1 & baseline$cyclist == 1 & (baseline$Pcyc > baseline$justrandom) ,]) > 0)
nrow(baseline[baseline$Cycled != 1 & baseline$cyclist == 1 & (baseline$Pcyc > baseline$justrandom) ,]) > 0
source("0_topflow2-2012.R")
sum(MS1_ebik0_eq0$METh)
sum(MS64_ebik0_eq0$METh)
sum(MS2_ebik0_eq0$METh)
source("0_topflow2-2012.R")
sum(MS1_ebik0_eq0$METh)
sum(MS2_ebik0_eq0$METh)
sum(MS4_ebik0_eq0$METh)
sum(MS64_ebik0_eq0$METh)
source("3_CBM2_Aggregates-2012.R")
sum(MS1_ebik0_eq0$MMETh)
sum(MS64_ebik0_eq1$MMETh)
sum(MS64_ebik0_eq1$METh)
sum(MS1_ebik0_eq1$METh)
source("0_topflow2-2012.R")
sum(MS64_ebik0_eq1$METh)
sum(MS1_ebik0_eq1$METh)
sum(MS1_ebik0_eq1$MMETh)
sum(MS64_ebik0_eq1$MMETh)
source("3_CBM2_Aggregates-2012.R")
source("6_CBM2_ScenarioAggregates.R")
source("health calculations/health_calculations.R")
View(mmets)
View(pif)
View(yll)
yll_red <- calculate_pif_reduction(pif, gbd, "yll")
yll_red <- calculate_pif_reduction(pif, gbd)
pif_red <- calculate_pif_reduction(rr, people_with_no_trips_rr)
pif_red <- arrange(pif_red, age.band, gender)
View(pif_red)
class(pif_red$baseline_mmet)
pif_red <- calculate_pif_reduction(rr, people_with_no_trips_rr)
View(pif_red)
class(pif_red$baseline_mmet)
class(pif_red)
class(pif_red$age.band)
td <- pif_red
td$baseline_mmet <- as.numeric(as.character(td$baseline_mmet))
class(td$baseline_mmet)
td$age.band <- as.character.factor(td$age.band)
td$gender <- as.numeric(as.character(td$gender))
class(td$age.band)
class(td$gender)
yll_red <- calculate_health_reductions(pif, gbd, td, hm = "yll")
View(yll_red)
View(yll)
View(yll_red)
View(pif_red)
View(pif)
View(pif_red)
View(yll_red)
tripsdf <- create_trips(bl, listOfScenarios)
source("health calculations/functions.R")
tripsdf <- create_trips(bl, listOfScenarios)
View(tripsdf)
sum(tripsdf$MainMode_Reduced)
sum(tripsdf$MS1_ebik0_eq0)
write.csv(tripsdf, "csv/tripsdf.csv", row.names = F)
